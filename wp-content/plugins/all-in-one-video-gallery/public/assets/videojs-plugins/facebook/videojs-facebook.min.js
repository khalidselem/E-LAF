/*! @name videojs-facebook @version 1.4.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsFacebook=t(e.videojs)}(this,function(e){"use strict";var t,i,a,o,s,n,r,c,u=(e=e&&e.hasOwnProperty("default")?e.default:e).browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,l=e.getComponent("Tech"),d=function(t){var i,a;function o(e,i){var a;return(a=t.call(this,e,i)||this).facebookState={state:"unstarted",volume:1,muted:!!a.options_.muted,duration:0},a.setPoster(e.poster),a.setSrc(a.options_.source),a.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-facebook",u&&(this.el_.parentNode.className+=" vjs-facebook-mobile"),this.el_.parentNode.className+=" vjs-waiting",o.isApiReady?this.initFacebookPlayer():o.apiReadyQueue.push(this))}.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a))),a}a=t,(i=o).prototype=Object.create(a.prototype),i.prototype.constructor=i,i.__proto__=a;var s=o.prototype;return s.dispose=function(){if(this.facebookPlayer)this.facebookPlayer.pause&&this.facebookPlayer.pause();else{var e=o.apiReadyQueue.indexOf(this);-1!==e&&o.apiReadyQueue.splice(e,1)}this.facebookPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-facebook","").replace(" vjs-facebook-mobile",""),this.el_.parentNode.removeChild(this.el_),t.prototype.dispose.call(this)},s.createEl=function(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),e.setAttribute("class","fb-video vjs-tech"),e.setAttribute("data-href",this.options_.source.src),e.setAttribute("data-allowfullscreen",!0);var t=document.createElement("div");if(t.appendChild(e),!u&&!this.options_.facebookControls){var i=document.createElement("div");i.setAttribute("class","vjs-iframe-blocker"),i.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),t.appendChild(i)}return t},s.initFacebookPlayer=function(){var e=this;this.facebookPlayer=null,FB.Event.subscribe("xfbml.ready",function(t){"video"===t.type&&t.id===e.options_.techId&&(e.facebookPlayer=t.instance,e.el_.parentNode.className=e.el_.parentNode.className.replace(" vjs-waiting",""),e.trigger("loadstart"),e.onPlayerReady(),e.facebookPlayer.subscribe("startedBuffering",function(t){e.onStateChange("startedBuffering")}),e.facebookPlayer.subscribe("finishedBuffering",function(t){e.onStateChange("finishedBuffering")}),e.facebookPlayer.subscribe("startedPlaying",function(t){e.onStateChange("startedPlaying")}),e.facebookPlayer.subscribe("paused",function(t){e.onStateChange("paused")}),e.facebookPlayer.subscribe("finishedPlaying",function(t){e.onStateChange("finishedPlaying")}),e.facebookPlayer.subscribe("error",function(t){e.onStateChange("error")}))})},s.onPlayerReady=function(){this.options_.muted&&this.facebookPlayer.mute(),this.isReady_=!0,this.triggerReady(),this.trigger("loadedmetadata"),this.trigger("loadeddata"),this.trigger("canplay"),this.trigger("canplaythrough"),this.trigger("volumechange"),this.playOnReady&&this.play()},s.onStateChange=function(e){switch(this.lastState=e,e){case"startedBuffering":this.facebookState.state="buffering";break;case"finishedBuffering":break;case"startedPlaying":this.facebookState.state="playing",this.trigger("timeupdate"),this.trigger("durationchange"),this.trigger("playing"),this.trigger("play"),this.isSeeking&&this.onSeeked();break;case"paused":this.isSeeking?this.onSeeked():(this.facebookState.state="paused",this.trigger("pause"));break;case"finishedPlaying":this.options_.loop?this.facebookPlayer.play():(this.facebookState.state="ended",this.trigger("ended"));break;case"error":console.log("error")}},s.error=function(){return{code:null,message:null}},s.poster=function(){return u?null:this.poster_},s.setPoster=function(e){this.poster_=e},s.loadVideoByUrl_=function(e){},s.cueVideoByUrl_=function(e){},s.src=function(e){return e&&this.setSrc({src:e}),this.source},s.setSrc=function(e){e&&e.src&&(this.source=e,this.url=e.src,this.options_.autoplay&&!u?this.isReady_?this.play():this.playOnReady=!0:this.activeVideoUrl!==this.url&&(this.isReady_?(this.cueVideoByUrl_(this.url),this.activeVideoUrl=this.url):this.cueOnReady=!0))},s.autoplay=function(){return this.options_.autoplay},s.setAutoplay=function(e){this.options_.autoplay=e},s.loop=function(){return this.options_.loop},s.setLoop=function(e){this.options_.loop=e},s.play=function(){this.url&&(this.wasPausedBeforeSeek=!1,this.isReady_?this.activeVideoUrl===this.url?this.facebookPlayer.play():(this.loadVideoByUrl_(this.url),this.activeVideoUrl=this.url):this.playOnReady=!0)},s.pause=function(){this.facebookPlayer&&this.facebookPlayer.pause()},s.paused=function(){return"playing"!==this.facebookState.state&&"buffering"!==this.facebookState.state},s.currentTime=function(){return this.facebookPlayer?this.facebookPlayer.getCurrentPosition():0},s.setCurrentTime=function(e){this.facebookPlayer&&("paused"===this.lastState&&(this.timeBeforeSeek=this.currentTime()),this.isSeeking||(this.wasPausedBeforeSeek=this.paused()),this.facebookPlayer.seek(e),this.trigger("timeupdate"),this.trigger("seeking"),this.isSeeking=!0,"paused"===this.lastState&&this.timeBeforeSeek!==e&&(clearInterval(this.checkSeekedInPauseInterval),this.checkSeekedInPauseInterval=setInterval(function(){"paused"===this.lastState&&this.isSeeking?this.currentTime()!==this.timeBeforeSeek&&(this.trigger("timeupdate"),this.onSeeked()):clearInterval(this.checkSeekedInPauseInterval)}.bind(this),250)))},s.seeking=function(){return this.isSeeking},s.seekable=function(){return e.createTimeRange(0,this.facebookState.duration)},s.onSeeked=function(){clearInterval(this.checkSeekedInPauseInterval),this.isSeeking=!1,this.wasPausedBeforeSeek?this.pause():this.play(),this.trigger("seeked")},s.playbackRate=function(){return 1},s.setPlaybackRate=function(e){},s.duration=function(){var e=this;if(0===this.facebookState.duration){this.on("timeupdate",function t(){e.facebookState.duration=e.facebookPlayer.getDuration(),e.facebookState.duration>0&&(e.trigger("durationchange"),e.off("timeupdate",t))})}return this.facebookState.duration},s.currentSrc=function(){return this.source&&this.source.src},s.ended=function(){return"ended"===this.facebookState.state},s.volume=function(){return this.facebookState.volume},s.setVolume=function(e){this.facebookPlayer&&(this.facebookPlayer.setVolume(e),this.facebookState.volume=e,this.trigger("volumechange"))},s.muted=function(){return this.facebookState.muted},s.setMuted=function(e){this.facebookPlayer&&(e?this.facebookPlayer.mute():this.facebookPlayer.unmute(),this.facebookState.muted=e,this.trigger("volumechange"))},s.buffered=function(){return e.createTimeRange()},s.supportsFullScreen=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},s.preload=function(){},s.load=function(){},s.reset=function(){},s.networkState=function(){if(!this.facebookPlayer)return 0;switch(this.facebookState.state){case"unstarted":return 0;case"buffering":return 2;default:return 1}},s.readyState=function(){if(!this.facebookPlayer)return 0;switch(this.facebookState.state){case"unstarted":return 0;case"ready":return 1;case"buffering":return 2;default:return 4}},o}(l);if(d.isSupported=function(){return!0},l.withSourceHandlers(d),d.nativeSourceHandler={},d.nativeSourceHandler.canPlayType=function(e){return"video/facebook"===e?"maybe":""},d.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return d.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=/facebook.com/.test(e.src)?"video/facebook":"";return d.nativeSourceHandler.canPlayType(i)}return""},d.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},d.nativeSourceHandler.dispose=function(){},d.registerSourceHandler(d.nativeSourceHandler),d.apiReadyQueue=[],"undefined"!=typeof document){var h=document.createElement("div");h.setAttribute("id","fb-root"),document.body.insertBefore(h,document.body.firstChild),o="https://connect.facebook.net/en_US/sdk.js",s=function(){window.fbAsyncInit=function(){FB.init({appId:"",xfbml:!0,version:"v3.2"})},d.isApiReady=!0;for(var e=0;e<d.apiReadyQueue.length;++e)d.apiReadyQueue[e].initFacebookPlayer()},n=!1,r=document.createElement("script"),(c=document.getElementsByTagName("script")[0]).parentNode.insertBefore(r,c),r.onload=function(){n||(n=!0,s())},r.onreadystatechange=function(){n||"complete"!==this.readyState&&"loaded"!==this.readyState||(n=!0,s())},r.src=o,t=".vjs-facebook iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }.vjs-facebook .vjs-iframe-blocker { display: none; }.vjs-facebook.vjs-has-started .vjs-iframe-blocker { display: block; }.vjs-facebook .vjs-poster { background-size: cover; }.vjs-facebook:not(.vjs-has-started) { cursor: pointer; }.vjs-facebook:not(.vjs-has-started) .vjs-poster, .vjs-facebook:not(.vjs-has-started) .vjs-big-play-button { pointer-events: none; }",i=document.head||document.getElementsByTagName("head")[0],(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),i.appendChild(a)}return d.VERSION="1.4.0",l.registerTech("Facebook",d),d});
